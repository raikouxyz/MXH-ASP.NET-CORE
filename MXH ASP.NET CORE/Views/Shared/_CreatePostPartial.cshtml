@model MXH_ASP.NET_CORE.ViewModels.CreatePostViewModel

<div class="card shadow-sm mb-4">
    <div class="card-body">
        <form asp-controller="Post" asp-action="Create" method="post" enctype="multipart/form-data">
            <div class="d-flex mb-3">
                @{
                    var imagePath = string.IsNullOrEmpty(ViewBag.CurrentUserAvatar as string) 
                        ? "/uploads/avatars/default-avatar.svg" 
                        : (ViewBag.CurrentUserAvatar as string);
                }
                <img src="@imagePath" 
                     class="rounded-circle me-2" alt="Avatar" style="width: 40px; height: 40px; object-fit: cover;">
                <div class="form-floating flex-grow-1">
                    <textarea asp-for="Content" class="form-control" placeholder="Bạn đang nghĩ gì?" style="height: 80px; border-radius: 20px;"></textarea>
                    <label asp-for="Content">Bạn đang nghĩ gì?</label>
                    <span asp-validation-for="Content" class="text-danger"></span>
                </div>
            </div>
            
            <!-- Preview ảnh -->
            <div id="imagePreview" class="mb-3" style="display: none;">
                <div class="position-relative d-inline-block">
                    <img id="previewImg" src="#" alt="Preview" class="img-fluid rounded" style="max-height: 300px;">
                    <button type="button" class="btn btn-danger btn-sm position-absolute top-0 end-0 m-2" onclick="removeImage()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <hr>
            
            <div class="d-flex justify-content-between">
                <div>
                    <label for="imageInput" class="btn btn-light rounded-circle" title="Thêm ảnh">
                        <i class="fas fa-image"></i>
                    </label>
                    <input type="file" id="imageInput" name="ImageFile" accept="image/*" style="display: none;" onchange="previewImage(this)">
                    <button type="button" class="btn btn-light rounded-circle" title="Thêm emoji" id="emojiButton">
                        <i class="fas fa-smile"></i>
                    </button>
                </div>
                <button type="submit" class="btn btn-primary px-4 rounded-pill">
                    <i class="fas fa-paper-plane me-1"></i> Đăng
                </button>
            </div>

            <!-- Emoji Picker -->
            <div id="emojiPicker" class="position-absolute bg-white border rounded shadow-sm p-2" style="display: none; z-index: 1000;">
                <div class="emoji-container" style="max-height: 300px; overflow-y: auto;">
                    <div class="emoji-category mb-2">
                        <h6 class="mb-2">Cảm xúc</h6>
                        <div class="emoji-row">
                            <span class="emoji" onclick="insertEmoji('😊')">😊</span>
                            <span class="emoji" onclick="insertEmoji('😂')">😂</span>
                            <span class="emoji" onclick="insertEmoji('😍')">😍</span>
                            <span class="emoji" onclick="insertEmoji('🥰')">🥰</span>
                            <span class="emoji" onclick="insertEmoji('😭')">😭</span>
                            <span class="emoji" onclick="insertEmoji('😢')">😢</span>
                            <span class="emoji" onclick="insertEmoji('😡')">😡</span>
                            <span class="emoji" onclick="insertEmoji('🤔')">🤔</span>
                            <span class="emoji" onclick="insertEmoji('😎')">😎</span>
                            <span class="emoji" onclick="insertEmoji('😴')">😴</span>
                        </div>
                    </div>
                    <div class="emoji-category mb-2">
                        <h6 class="mb-2">Biểu tượng</h6>
                        <div class="emoji-row">
                            <span class="emoji" onclick="insertEmoji('❤️')">❤️</span>
                            <span class="emoji" onclick="insertEmoji('👍')">👍</span>
                            <span class="emoji" onclick="insertEmoji('🙏')">🙏</span>
                            <span class="emoji" onclick="insertEmoji('🎉')">🎉</span>
                            <span class="emoji" onclick="insertEmoji('✨')">✨</span>
                            <span class="emoji" onclick="insertEmoji('💪')">💪</span>
                            <span class="emoji" onclick="insertEmoji('🎯')">🎯</span>
                            <span class="emoji" onclick="insertEmoji('🌟')">🌟</span>
                            <span class="emoji" onclick="insertEmoji('🔥')">🔥</span>
                            <span class="emoji" onclick="insertEmoji('💯')">💯</span>
                        </div>
                    </div>
                    <div class="emoji-category">
                        <h6 class="mb-2">Động vật</h6>
                        <div class="emoji-row">
                            <span class="emoji" onclick="insertEmoji('🐶')">🐶</span>
                            <span class="emoji" onclick="insertEmoji('🐱')">🐱</span>
                            <span class="emoji" onclick="insertEmoji('🐼')">🐼</span>
                            <span class="emoji" onclick="insertEmoji('🦁')">🦁</span>
                            <span class="emoji" onclick="insertEmoji('🐯')">🐯</span>
                            <span class="emoji" onclick="insertEmoji('🦊')">🦊</span>
                            <span class="emoji" onclick="insertEmoji('🦄')">🦄</span>
                            <span class="emoji" onclick="insertEmoji('🦋')">🦋</span>
                            <span class="emoji" onclick="insertEmoji('🦜')">🦜</span>
                            <span class="emoji" onclick="insertEmoji('🦢')">🦢</span>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<style>
    .emoji {
        display: inline-block;
        padding: 8px;
        cursor: pointer;
        font-size: 1.5rem;
        transition: transform 0.2s;
        border-radius: 4px;
    }
    .emoji:hover {
        transform: scale(1.2);
        background-color: #f8f9fa;
    }
    .emoji-container {
        width: 300px;
    }
    .emoji-row {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 5px;
        margin-bottom: 10px;
    }
    .emoji-category h6 {
        color: #6c757d;
        font-size: 0.9rem;
        padding-left: 5px;
    }
</style>

<script>
    let emojiPickerVisible = false;
    const emojiButton = document.getElementById('emojiButton');
    const emojiPicker = document.getElementById('emojiPicker');

    function previewImage(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            
            reader.onload = function(e) {
                $('#previewImg').attr('src', e.target.result);
                $('#imagePreview').show();
            }
            
            reader.readAsDataURL(input.files[0]);
        }
    }
    
    function removeImage() {
        $('#imageInput').val('');
        $('#imagePreview').hide();
        $('#previewImg').attr('src', '#');
    }

    // Xử lý sự kiện click cho nút emoji
    emojiButton.addEventListener('click', function(e) {
        e.stopPropagation();
        toggleEmojiPicker();
    });

    function toggleEmojiPicker() {
        emojiPickerVisible = !emojiPickerVisible;
        
        if (emojiPickerVisible) {
            const buttonRect = emojiButton.getBoundingClientRect();
            emojiPicker.style.display = 'block';
            emojiPicker.style.top = `${buttonRect.bottom + window.scrollY + 5}px`;
            emojiPicker.style.left = `${buttonRect.left + window.scrollX}px`;
            
            // Thêm event listener cho document
            document.addEventListener('click', handleDocumentClick);
        } else {
            emojiPicker.style.display = 'none';
            document.removeEventListener('click', handleDocumentClick);
        }
    }

    function handleDocumentClick(e) {
        if (!emojiPicker.contains(e.target) && e.target !== emojiButton) {
            emojiPickerVisible = false;
            emojiPicker.style.display = 'none';
            document.removeEventListener('click', handleDocumentClick);
        }
    }

    function insertEmoji(emoji) {
        const textarea = document.querySelector('textarea[name="Content"]');
        const start = textarea.selectionStart;
        const end = textarea.selectionEnd;
        const text = textarea.value;
        
        textarea.value = text.substring(0, start) + emoji + text.substring(end);
        textarea.selectionStart = textarea.selectionEnd = start + emoji.length;
        textarea.focus();
    }
</script> 